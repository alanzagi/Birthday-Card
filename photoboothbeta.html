<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Photo Booth Cheli üéÄ (9:16)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Agar video pas di container dan tidak crop */
      #video {
        width: 360px;
        height: 640px;
        object-fit: contain;
        background: black;
        border-radius: 1rem;
      }
      #frameOverlay {
        width: 360px;
        height: 640px;
        object-fit: cover;
        position: absolute;
        top: 0;
        left: 0;
        pointer-events: none;
        border-radius: 1rem;
      }
      #previewContainer img {
        width: 360px;
        height: 640px;
        object-fit: cover;
        border-radius: 1rem;
        box-shadow: 0 10px 15px -3px rgb(219 39 119 / 0.5);
        margin-bottom: 0.5rem;
      }
    </style>
  </head>
  <body class="bg-pink-50 flex flex-col items-center justify-center min-h-screen p-4">
    <h1 class="text-2xl font-semibold text-pink-600 mb-6">üì∏ Photo Booth for Cheli üéÄ (9:16)</h1>

    <!-- FRAME + VIDEO -->
    <div class="relative w-[360px] h-[640px] rounded-xl overflow-hidden border-4 border-pink-300 shadow-xl mb-6 bg-url">
      <video id="video" autoplay playsinline muted class=""></video>
      <img id="frameOverlay" src="img/de475d56-1910-4254-ba9c-6358f1037e77.png" alt="Frame Overlay" />
    </div>

    <!-- TOMBOL AMBIL FOTO -->
    <button id="captureBtn" class="bg-pink-500 text-white px-6 py-3 rounded-full shadow-md hover:bg-pink-600 transition mb-6 text-lg">üéÄ Ambil Foto</button>

    <!-- PREVIEW FOTO -->
    <div id="previewContainer" class="flex flex-col items-center">
      <img id="photoPreview" alt="Preview Foto" class="" />
      <a id="downloadBtn" href="#" download="cheli_frame_9_16.png" class="hidden bg-pink-600 text-white px-4 py-2 rounded-md hover:bg-pink-700 transition"> ‚¨áÔ∏è Download Foto </a>
    </div>

    <!-- CANVAS HIDDEN -->
    <canvas id="canvas" width="360" height="640" class="hidden"></canvas>

    <script>
      const video = document.getElementById("video");
      const canvas = document.getElementById("canvas");
      const captureBtn = document.getElementById("captureBtn");
      const frameOverlay = document.getElementById("frameOverlay");
      const photoPreview = document.getElementById("photoPreview");
      const downloadBtn = document.getElementById("downloadBtn");

      // Akses webcam
      navigator.mediaDevices
        .getUserMedia({
          video: {
            facingMode: "user",
            // jangan tentukan resolusi untuk fleksibel semua hp
          },
        })
        .then((stream) => {
          video.srcObject = stream;
        })
        .catch((err) => {
          alert("Tidak bisa mengakses kamera: " + err.message);
        });

      captureBtn.addEventListener("click", () => {
        const ctx = canvas.getContext("2d");

        // Clear canvas dulu
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Gambar video dengan ukuran canvas (360x640)
        ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

        // Gambar frame overlay
        if (frameOverlay.complete) {
          ctx.drawImage(frameOverlay, 0, 0, canvas.width, canvas.height);
          showResult();
        } else {
          frameOverlay.onload = () => {
            ctx.drawImage(frameOverlay, 0, 0, canvas.width, canvas.height);
            showResult();
          };
        }

        function showResult() {
          const imageUrl = canvas.toDataURL("image/png");
          photoPreview.src = imageUrl;
          downloadBtn.href = imageUrl;
          downloadBtn.classList.remove("hidden");
        }
      });
    </script>
  </body>
</html>
